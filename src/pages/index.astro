---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// è·å–æœ€æ–°çš„æ–‡ç« å’Œè¯´è¯´
const allPosts = await getCollection('posts');
const allThoughts = await getCollection('thoughts');

// æŒ‰æ—¥æœŸæ’åºå¹¶è·å–æœ€æ–°çš„å‡ ç¯‡
const recentPosts = allPosts
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 5);

const recentThoughts = allThoughts
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 10);

// æ¸²æŸ“è¯´è¯´å†…å®¹
const thoughtsWithContent = await Promise.all(
  recentThoughts.map(async (thought) => {
    const { Content } = await thought.render();
    return { thought, Content };
  })
);
---

<BaseLayout title="x1ngg3 çš„åšå®¢ - é¦–é¡µ">
  <div class="container">
    <!-- Hero Section -->
    <section class="hero">
      <h1 class="hero-title">Hi, æˆ‘æ˜¯ x1ngg3 ğŸ‘‹</h1>
      <p class="hero-description">
        æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸ªäººåšå®¢ï¼è¿™é‡Œè®°å½•æˆ‘çš„æŠ€æœ¯å­¦ä¹ ã€é¡¹ç›®ç»éªŒå’Œç”Ÿæ´»æ„Ÿæ‚Ÿã€‚
      </p>
      <div class="hero-links">
        <a href="/posts" class="button">æŸ¥çœ‹æ–‡ç« </a>
        <a href="/thoughts" class="button button-secondary">çœ‹çœ‹è¯´è¯´</a>
      </div>
    </section>

    <!-- æœ€æ–°æ–‡ç«  -->
    <section class="section">
      <div class="section-header">
        <h2>æœ€æ–°æ–‡ç« </h2>
        <a href="/posts" class="view-all">æŸ¥çœ‹å…¨éƒ¨ â†’</a>
      </div>

      {recentPosts.length > 0 ? (
        <div class="posts-grid">
          {recentPosts.map(post => (
            <a href={`/posts/${post.slug}`} class="post-card-link">
              <article class="post-card card">
                <h3 class="post-title">{post.data.title}</h3>
                <p class="post-description">{post.data.description}</p>
                <div class="post-meta">
                  <time datetime={post.data.date.toISOString()}>
                    {post.data.date.toLocaleDateString('zh-CN', {
                      year: 'numeric',
                      month: '2-digit',
                      day: '2-digit'
                    })}
                  </time>
                  {post.data.tags && post.data.tags.length > 0 && (
                    <div class="post-tags">
                      {post.data.tags.slice(0, 3).map(tag => (
                        <span class="tag">{tag}</span>
                      ))}
                    </div>
                  )}
                </div>
              </article>
            </a>
          ))}
        </div>
      ) : (
        <p class="empty-state">è¿˜æ²¡æœ‰æ–‡ç« ï¼Œå¿«å» src/content/posts/ ç›®å½•æ·»åŠ ä½ çš„ç¬¬ä¸€ç¯‡æ–‡ç« å§ï¼</p>
      )}
    </section>

    <!-- æœ€æ–°è¯´è¯´ -->
    <section class="section">
      <div class="section-header">
        <h2>æœ€æ–°è¯´è¯´</h2>
        <a href="/thoughts" class="view-all">æŸ¥çœ‹å…¨éƒ¨ â†’</a>
      </div>

      {thoughtsWithContent.length > 0 ? (
        <div class="thoughts-list">
          {thoughtsWithContent.map(({ thought, Content }) => (
            <div class="thought-item">
              <div class="thought-content">
                <Content />
              </div>
              <time class="thought-time" datetime={thought.data.date.toISOString()}>
                {thought.data.date.toLocaleDateString('zh-CN', {
                  month: '2-digit',
                  day: '2-digit',
                  hour: '2-digit',
                  minute: '2-digit'
                })}
              </time>
            </div>
          ))}
        </div>
      ) : (
        <p class="empty-state">è¿˜æ²¡æœ‰è¯´è¯´ï¼Œå¿«å» src/content/thoughts/ ç›®å½•æ·»åŠ ä½ çš„ç¬¬ä¸€æ¡è¯´è¯´å§ï¼</p>
      )}
    </section>
  </div>
</BaseLayout>

<style>
  .hero {
    text-align: center;
    padding: 4rem 0;
    margin-bottom: 3rem;
  }

  .hero-title {
    font-size: 3rem;
    margin-bottom: 1rem;
    background: linear-gradient(135deg, var(--color-primary), #8b5cf6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .hero-description {
    font-size: 1.25rem;
    color: var(--color-text-secondary);
    max-width: 600px;
    margin: 0 auto 2rem;
  }

  .hero-links {
    display: flex;
    gap: 1rem;
    justify-content: center;
  }

  .button-secondary {
    background: var(--color-bg-secondary);
    color: var(--color-text);
  }

  .button-secondary:hover {
    background: var(--color-border);
    color: var(--color-text);
  }

  .section {
    margin-bottom: 4rem;
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
  }

  .section-header h2 {
    margin: 0;
    font-size: 2rem;
  }

  .view-all {
    color: var(--color-primary);
    font-weight: 500;
  }

  .posts-grid {
    display: grid;
    gap: 1.5rem;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  }

  .post-card-link {
    text-decoration: none;
    color: inherit;
    display: block;
  }

  .post-card {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    height: 100%;
    cursor: pointer;
  }

  .post-title {
    margin: 0;
    font-size: 1.25rem;
    color: var(--color-text);
    transition: color 0.2s;
  }

  .post-card-link:hover .post-title {
    color: var(--color-primary);
  }

  .post-description {
    color: var(--color-text-secondary);
    margin: 0;
    flex: 1;
  }

  .post-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.875rem;
    color: var(--color-text-secondary);
  }

  .post-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .thoughts-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .thought-item {
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: 12px;
    padding: 1rem 1.5rem;
  }

  .thought-content {
    color: var(--color-text);
    margin-bottom: 0.5rem;
  }

  .thought-time {
    font-size: 0.875rem;
    color: var(--color-text-secondary);
  }

  .empty-state {
    text-align: center;
    padding: 3rem;
    color: var(--color-text-secondary);
    background: var(--color-bg-secondary);
    border-radius: 12px;
  }

  @media (max-width: 768px) {
    .hero-title {
      font-size: 2rem;
    }

    .hero-description {
      font-size: 1rem;
    }

    .posts-grid {
      grid-template-columns: 1fr;
    }

    .section-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }
  }
</style>
